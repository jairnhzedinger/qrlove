<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QRLove</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Crie uma pÃ¡gina personalizada para celebrar seu amor com o QRLove. Adicione fotos, datas importantes e muito mais. Veja quanto tempo estÃ£o juntos!">
  <meta name="robots" content="index, follow">
  <meta property="og:title" content="QRLove: Celebrando o Amor">
  <meta property="og:description" content="Adicione fotos, datas importantes e veja quanto tempo estÃ£o juntos com o QRLove!">
  <meta name="keywords" content="amor, casal, QRCode, celebraÃ§Ã£o de amor, tempo juntos">

  <style>
    /* Estilo global */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Arial', sans-serif;
      background-color: #f0f0f0;
      color: #333;
    }

    .container {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      max-width: 1000px;
      margin: 40px auto;
      padding: 20px;
      background-color: #fff;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      border-radius: 15px;
      gap: 20px;
    }

    /* FormulÃ¡rio Ã  esquerda */
    .form-container {
      width: 48%;
      background-color: #ffffff;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    /* TÃ­tulo estilizado */
    h1 {
      text-align: center;
      color: #ff5e5e;
      font-size: 32px;
      margin-bottom: 20px;
    }

    /* Form Styles */
    form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    input[type="text"],
    input[type="date"],
    select,
    button,
    label {
      width: 100%;
      padding: 14px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
    }

    input[type="text"],
    select {
      background-color: #f9f9f9;
      color: #333;
    }

    /* Estilo do campo de data */
    input[type="date"] {
      background-color: #f9f9f9;
      color: #333;
      appearance: none; /* Remove o estilo padrÃ£o em navegadores */
      -webkit-appearance: none; /* Remove o estilo padrÃ£o no iOS */
    }

    /* Estilo especÃ­fico para o campo de data no iOS */
    input[type="date"]::before {
      content: attr(placeholder);
      color: #999;
    }

    input[type="date"]:focus::before,
    input[type="date"]:valid::before {
      content: "";
    }

    /* Estilo personalizado para o input de foto */
    input[type="file"] {
      display: none;
    }

    .custom-file-upload {
      display: inline-block;
      width: 100%;
      padding: 14px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #f9f9f9;
      font-size: 16px;
      text-align: center;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .custom-file-upload:hover {
      background-color: #e6e6e6;
    }

    /* BotÃ£o Comprar */
    .comprar-btn {
      background-color: #ff5e5e;
      color: white;
      font-size: 18px;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
      text-transform: uppercase;
      margin-top: 20px;
      width: 100%;
    }

    .comprar-btn:hover {
      background-color: #ff3333;
      box-shadow: 0 4px 12px rgba(255, 51, 51, 0.3);
    }

    /* EstilizaÃ§Ã£o do texto explicativo */
.explanation {
  margin-top: 40px;
  background-color: #ffeded;
  border-radius: 15px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 4px 10px rgba(255, 51, 51, 0.1);
}

.explanation h3 {
  color: #ff5e5e;
  font-size: 24px;
  margin-bottom: 15px;
  font-weight: bold;
}

.explanation p {
  font-size: 16px;
  color: #555;
  line-height: 1.6;
  margin-bottom: 15px;
}

.explanation p:last-child {
  margin-bottom: 0;
}

.explanation p strong {
  color: #ff5e5e;
}

    /* Estilos para prÃ©-visualizaÃ§Ã£o */
    .preview-container {
      width: 48%;
      padding: 20px;
      background-color: #ff5e5e;
      color: rgb(255, 255, 255);
      border-radius: 15px;
      text-align: center;
    }

    .preview-container img {
      border-radius: 10px;
      max-width: 100%;
    }

    .countdown {
      margin-top: 20px;
      font-size: 1.5rem;
    }

    /* Responsividade */
    @media (max-width: 800px) {
      .explanation {
    padding: 15px;
  }

  .explanation h3 {
    font-size: 22px;
  }

  .explanation p {
    font-size: 15px;
  }

      .container {
        flex-direction: column;
      }

      .form-container,
      .preview-container {
        width: 100%;
      }

      .comprar-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- FormulÃ¡rio -->
    <div class="form-container">
      <h1>QRLove</h1>
      <!-- Adicionar o enctype para permitir o envio de arquivos -->
      <form id="checkout-form" enctype="multipart/form-data">
        <input type="text" id="couple-name" name="couple-name" placeholder="Nome do casal" required>

        <!-- Estilo customizado para input de arquivo -->
        <label for="photo" class="custom-file-upload">Escolha uma foto de vocÃªs</label>
        <input type="file" id="photo" name="photo" accept="image/*" onchange="previewImage(event)" required>

        <!-- Input de data com placeholder -->
        <input type="date" id="start-date" name="start-date" placeholder="Data de inÃ­cio" required>

        <select id="plan" name="plan">
          <option value="" disabled selected>Selecione um plano</option>
          <option value="1">Anual (R$ 19,90)</option>
          <option value="2">Lifetime (R$ 49,90)</option>
        </select>
      </form>      
    </div>

    <!-- Preview Container -->
    <div class="preview-container" id="mobile-preview">
      <h2>A histÃ³ria de </h2>
      <h2 id="couple-name-preview">*******</h2>
      <img id="photo-final" src="https://via.placeholder.com/720x1080/ffffff/ff5e5e?text=Foto+de+vocÃªs!">
      <div class="countdown" id="countdown">0 anos, 0 meses, 0 dias, 0 horas, 0 minutos, 0 segundos</div>
    </div>

    <!-- BotÃ£o Comprar dentro do container, mas fora da preview-container -->
    <button class="comprar-btn" id="comprar-btn" type="button">Comprar</button>

    <!-- Texto persuasivo e amoroso abaixo do botÃ£o de comprar -->
    <div class="explanation">
      <h3>QRLove: O BaÃº Digital Eterno do Seu Amor ğŸ’–</h3>
      <p><strong>QRLove</strong> Ã© mais do que uma simples lembranÃ§a â€“ Ã© o baÃº digital que vai eternizar a sua histÃ³ria de amor ğŸ’âœ¨. Com o plano <strong>Lifetime</strong>, criamos uma imagem Ãºnica do casal, decorada com um contador que mostra, em tempo real, exatamente quanto tempo vocÃªs estÃ£o juntos â³ğŸ’‘.</p>
      <p>Mas nÃ£o para por aÃ­! VocÃª receberÃ¡ essa imagem para download, jÃ¡ com um <strong>QR Code integrado</strong> ğŸ“², prontinha para ser impressa e colocada naquele quadro especial que vai brilhar na estante da sala ğŸ–¼ï¸ğŸ . Assim, quando seus amigos e familiares visitarem, eles poderÃ£o escanear o QR Code e ver nÃ£o sÃ³ a foto de vocÃªs, mas tambÃ©m hÃ¡ quanto tempo estÃ£o compartilhando essa incrÃ­vel jornada de amor! ğŸ˜ğŸ’«</p>
      <p>O buquÃª de flores pode murchar ğŸŒ¹, o champanhe pode acabar ğŸ¥‚, e aquela viagem de comemoraÃ§Ã£o dos sonhos vai, infelizmente, chegar ao fim ğŸ–ï¸âœˆï¸... Mas a <strong>QRLove</strong> vai estar lÃ¡, firme e forte ğŸ’ª, guardando todas essas memÃ³rias para sempre. Porque o amor pode ser eterno â€“ e, no <strong>QRLove</strong>, ele realmente Ã©! ğŸ’Œ</p>
      <p>E para quem ainda estÃ¡ nos primeiros capÃ­tulos dessa histÃ³ria de amor ğŸ“–, ou quer algo mais "vamos com calma", temos o plano <strong>Anual</strong> por apenas R$19,90! ğŸ˜œ Afinal, Ã s vezes o amor pode nÃ£o durar para sempre, nÃ©? ğŸ¤·â€â™€ï¸ Mas ei, quem sabe daqui a um ano a gente renova, nÃ©? ğŸ˜ Se tudo der certo e o coraÃ§Ã£o bater ainda mais forte ğŸ’“, vocÃª pode fazer o upgrade para o <strong>Lifetime</strong>! E se nÃ£o... bom, tem muitos peixes no mar ğŸ , e a <strong>QRLove</strong> estarÃ¡ aqui para a sua prÃ³xima grande histÃ³ria! ğŸ˜‰</p>
    </div>       
  </div>

  <script src="https://js.stripe.com/v3/"></script>
  <script>
    // VariÃ¡vel para armazenar o intervalo do countdown
    let countdownInterval;

    // FunÃ§Ã£o para mostrar a prÃ©via da imagem
    function previewImage(event) {
      const file = event.target.files[0];
      const photoFinal = document.getElementById('photo-final');

      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          photoFinal.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    }

    // FunÃ§Ã£o para iniciar o countdown
    function startCountdown(startDate) {
      const countdownElement = document.getElementById('countdown');
      const start = new Date(startDate);

      // Limpar o intervalo anterior para evitar que vÃ¡rios contadores rodem ao mesmo tempo
      if (countdownInterval) {
        clearInterval(countdownInterval);
      }

      function updateCountdown() {
        const now = new Date();
        const diff = now - start;

        const years = Math.floor(diff / (1000 * 60 * 60 * 24 * 365.25));
        const months = Math.floor((diff % (1000 * 60 * 60 * 24 * 365.25)) / (1000 * 60 * 60 * 24 * 30.44));
        const days = Math.floor((diff % (1000 * 60 * 60 * 24 * 30.44)) / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

        countdownElement.innerHTML = `${years} anos, ${months} meses, ${days} dias, ${hours} horas, ${minutes} minutos, ${seconds} segundos`;
      }

      countdownInterval = setInterval(updateCountdown, 1000);
    }

    // Atualizar nome do casal em tempo real
    document.getElementById('couple-name').addEventListener('input', (e) => {
      document.getElementById('couple-name-preview').innerText = e.target.value;
    });

    // Atualizar o countdown conforme a data de inÃ­cio
    document.getElementById('start-date').addEventListener('change', (e) => {
      startCountdown(e.target.value);
    });

    // Obter a chave pÃºblica do backend
    async function getPublicKey() {
      const response = await fetch('/config');
      const data = await response.json();
      return data.publicKey;
    }

    // Inicializar Stripe com a chave pÃºblica
    getPublicKey().then(publicKey => {
      const stripe = Stripe(publicKey);

      // FunÃ§Ã£o para iniciar a sessÃ£o de checkout
      document.getElementById('comprar-btn').addEventListener('click', async () => {
        const coupleName = document.getElementById('couple-name').value;
        const planId = document.getElementById('plan').value;
        const startDate = document.getElementById('start-date').value;
        const photo = document.getElementById('photo').files[0];

        // Criar o FormData para enviar a imagem e os outros dados
        const formData = new FormData();
        formData.append('coupleName', coupleName);
        formData.append('planId', planId);
        formData.append('startDate', startDate);
        formData.append('photo', photo);

        try {
          const response = await fetch('/create-checkout-session', {
            method: 'POST',
            body: formData // Usar FormData para enviar os dados
          });

          const session = await response.json();

          if (session.id) {
            // Redirecionar para o checkout do Stripe
            const { error } = await stripe.redirectToCheckout({ sessionId: session.id });
            if (error) {
              console.error('Erro ao redirecionar para o checkout:', error);
            }
          } else {
            console.error('Erro ao criar sessÃ£o:', session.error);
          }
        } catch (error) {
          console.error('Erro ao criar sessÃ£o de checkout:', error);
        }
      });
    }).catch(error => {
      console.error('Erro ao obter a chave pÃºblica:', error);
    });
  </script>
</body>
</html>
